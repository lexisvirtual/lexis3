{
  "version": 3,
  "sources": ["../../../src/index.js"],
  "sourceRoot": "C:\\Users\\aderv\\lexis3\\worker\\.wrangler\\tmp\\deploy-TOrLqJ",
  "sourcesContent": ["// import { getFallbackImage, refreshFallbackPool } from './fallback-manager.js';\r\n\r\nexport default {\r\n    // --- ROTAS HTTP (API Manual) ---\r\n    async fetch(request, env, ctx) {\r\n        const url = new URL(request.url);\r\n\r\n        // 1. Adicionar Pauta (ETAPA 1: Input Rico)\r\n        if (url.pathname === \"/add-topic\") {\r\n            if (request.method !== \"POST\") return new Response(\"Use POST\", { status: 405 });\r\n\r\n            const body = await request.json().catch(() => ({}));\r\n\r\n            // Valida\u00E7\u00E3o de Schema (ETAPA 1.2)\r\n            if (!body.topic || !body.cluster) {\r\n                return new Response(JSON.stringify({\r\n                    error: \"Schema Inv\u00E1lido. Obrigat\u00F3rio: 'topic' e 'cluster'.\",\r\n                    required: { query: \"string\", cluster: \"string\", intent: \"informacional|dor|decisao\" }\r\n                }), { status: 400, headers: { \"Content-Type\": \"application/json\" } });\r\n            }\r\n\r\n            const jobData = {\r\n                topic: body.topic.trim(),\r\n                cluster: body.cluster.trim().toLowerCase(),\r\n                intent: body.intent || \"informacional\",\r\n                type: body.type || \"evergreen\",\r\n                priority: body.priority || 1,\r\n                status: 'pending',\r\n                created_at: new Date().toISOString()\r\n            };\r\n\r\n            const id = Date.now().toString();\r\n            await env.LEXIS_PAUTA.put(`job:${id}`, JSON.stringify(jobData));\r\n\r\n            return new Response(JSON.stringify({ success: true, id, job: jobData }), {\r\n                headers: { \"Content-Type\": \"application/json\" }\r\n            });\r\n        }\r\n\r\n        // 2. Ver Fila\r\n        if (url.pathname === \"/queue\") {\r\n            const limit = parseInt(url.searchParams.get(\"limit\")) || 100; // Default: 100 items\r\n            const list = await env.LEXIS_PAUTA.list({ prefix: \"job:\", limit });\r\n            const jobs = [];\r\n            for (const key of list.keys) {\r\n                const value = await env.LEXIS_PAUTA.get(key.name);\r\n                jobs.push({ id: key.name, ...JSON.parse(value) });\r\n            }\r\n            return new Response(JSON.stringify(jobs, null, 2), { headers: { \"Content-Type\": \"application/json\" } });\r\n        }\r\n\r\n        // 3. For\u00E7ar Processamento\r\n        if (url.pathname === \"/process-queue\") {\r\n            return await processNextJob(env);\r\n        }\r\n\r\n        // 4. LIMPEZA TOTAL (NUCLEAR - TEMP)\r\n        if (url.pathname === \"/purge\") {\r\n            const list = await env.LEXIS_PAUTA.list({ prefix: \"job:\" });\r\n            for (const key of list.keys) {\r\n                await env.LEXIS_PAUTA.delete(key.name);\r\n            }\r\n            return new Response(\"Fila limpa! Zero items.\", { status: 200 });\r\n        }\r\n\r\n        // 5. RESET MEM\u00D3RIA (Apaga \u00EDndices de posts antigos)\r\n        if (url.pathname === \"/reset-memory\") {\r\n            const list = await env.LEXIS_PAUTA.list({ prefix: \"index:\" });\r\n            for (const key of list.keys) {\r\n                await env.LEXIS_PAUTA.delete(key.name);\r\n            }\r\n            return new Response(\"Mem\u00F3ria limpa: \u00CDndices apagados.\", { status: 200 });\r\n        }\r\n\r\n        // 6. ANALYTICS (Ver dados)\r\n        if (url.pathname === \"/analytics\") {\r\n            const analysis = await analyzePostHistory(env);\r\n            const context = getTemporalContext();\r\n\r\n            return new Response(JSON.stringify({\r\n                analysis,\r\n                context,\r\n                recommendations: analysis.gaps\r\n            }, null, 2), {\r\n                headers: { \"Content-Type\": \"application/json\" }\r\n            });\r\n        }\r\n\r\n        // 7. PLANEJAMENTO IA (Gerar Pautas)\r\n        if (url.pathname === \"/ai-plan\") {\r\n            const result = await selectThemesByAI(env);\r\n            return new Response(JSON.stringify(result, null, 2), {\r\n                headers: { \"Content-Type\": \"application/json\" }\r\n            });\r\n        }\r\n\r\n        // 8. SITEMAP DIN\u00C2MICO (SEO)\r\n        if (url.pathname === \"/sitemap.xml\") {\r\n            return await generateDynamicSitemap(env);\r\n        }\r\n\r\n        // 9. RSS FEED DIN\u00C2MICO (SEO)\r\n        if (url.pathname === \"/rss.xml\" || url.pathname === \"/feed.xml\") {\r\n            return await generateDynamicRSS(env);\r\n        }\r\n\r\n        return new Response(\"Lexis Publisher V5.8 (Advanced Art Director) Ativo\", { status: 200 });\r\n    },\r\n\r\n    // --- TRIGGERS AGENDADOS ---\r\n    async scheduled(event, env, ctx) {\r\n        ctx.waitUntil(processNextJob(env));\r\n    }\r\n};\r\n\r\n// --- ORQUESTRADOR ---\r\nasync function processNextJob(env) {\r\n    const list = await env.LEXIS_PAUTA.list({ prefix: \"job:\", limit: 1 });\r\n\r\n    if (list.keys.length === 0) {\r\n        console.log(\"[AUTO-REFILL] Fila vazia. Iniciando gera\u00E7\u00E3o autom\u00E1tica de pautas...\");\r\n        try {\r\n            const plan = await selectThemesByAI(env);\r\n            if (plan.success && plan.new_jobs && plan.new_jobs.length > 0) {\r\n                console.log(`[AUTO-REFILL] Sucesso! ${plan.new_jobs.length} novas pautas geradas.`);\r\n                // Recursivamente processa o primeiro da nova lista\r\n                return await processNextJob(env);\r\n            } else {\r\n                return new Response(`Fila vazia. Auto-gera\u00E7\u00E3o falhou: ${plan.error || \"Sem Jobs\"}`, { status: 200 });\r\n            }\r\n        } catch (e) {\r\n            return new Response(`Fila vazia. Erro no refill: ${e.message}`, { status: 500 });\r\n        }\r\n    }\r\n\r\n    const jobKey = list.keys[0].name;\r\n    const rawValue = await env.LEXIS_PAUTA.get(jobKey);\r\n\r\n    if (!rawValue) {\r\n        console.warn(`[ZOMBIE] Limpando item vazio: ${jobKey}`);\r\n        await env.LEXIS_PAUTA.delete(jobKey);\r\n        return new Response(\"Item fantasma removido. Tente novamente.\", { status: 200 });\r\n    }\r\n\r\n    const jobData = JSON.parse(rawValue);\r\n    console.log(`[ORCHESTRATOR] Iniciando: ${jobData.topic} (Cluster: ${jobData.cluster})`);\r\n\r\n    try {\r\n        const result = await generateAndPublishPost(env, jobData);\r\n\r\n        if (result.success) {\r\n            await env.LEXIS_PAUTA.delete(jobKey);\r\n            await addToClusterIndex(env, jobData.cluster, {\r\n                title: result.title,\r\n                slug: result.slug,\r\n                intent: jobData.intent,\r\n                published_at: new Date().toISOString().split('T')[0]\r\n            });\r\n\r\n            return new Response(JSON.stringify(result), { headers: { \"Content-Type\": \"application/json\" } });\r\n        } else {\r\n            console.error(`[FAIL] ${result.error}`);\r\n            const isValidationError = [\"Short Content\", \"No Structure (H2)\", \"Missing Fields\", \"Parsing Failed\"].includes(result.error) || result.reason === \"DUPLICATE_SLUG\";\r\n\r\n            if (isValidationError) {\r\n                console.warn(`[DELETE] Removendo job inv\u00E1lido da fila: ${jobData.topic}`);\r\n                await env.LEXIS_PAUTA.delete(jobKey);\r\n            }\r\n            return new Response(JSON.stringify(result), { status: 422, headers: { \"Content-Type\": \"application/json\" } });\r\n        }\r\n    } catch (e) {\r\n        return new Response(JSON.stringify({ error: e.message }), { status: 500 });\r\n    }\r\n}\r\n\r\n// --- N\u00DACLEO INTELIGENTE (IA + VALIDA\u00C7\u00C3O) ---\r\nasync function generateAndPublishPost(env, job) {\r\n    const relatedPosts = await getRelatedPosts(env, job.cluster);\r\n    const internalLinksPrompt = relatedPosts.length > 0\r\n        ? `INCLUA LINKS INTERNOS PARA: ${relatedPosts.map(p => `[${p.title}](/blog/${p.slug})`).join(\", \")}`\r\n        : \"\";\r\n\r\n    const systemPrompt = `\r\n    Voc\u00EA \u00E9 o Evangelista Chefe da Lexis Academy.\r\n    \r\n    SUA MISS\u00C3O: Escrever um artigo de blog pol\u00EAmico e profundo.\r\n    \r\n    PRINC\u00CDPIOS EDITORIAIS:\r\n    1. \"Idioma n\u00E3o se aprende. Idioma se treina.\"\r\n    2. Ataque m\u00E9todos tradicionais (gram\u00E1tica, decoreba).\r\n    3. Use H2 para subt\u00EDtulos (##).\r\n    \r\n    FORMATO DE SA\u00CDDA: JSON (ESTRITAMENTE)\r\n    {\r\n      \"title\": \"T\u00EDtulo H1 Impactante\",\r\n      \"slug\": \"slug-otimizado-seo\",\r\n      \"description\": \"Meta description persuasiva para Google (max 150 chars)\",\r\n      \"tags\": [\"tag1\", \"tag2\"],\r\n      \"content\": \"Texto completo do artigo em Markdown. Use ## para subt\u00EDtulos. N\u00C3O coloque o t\u00EDtulo H1 aqui dentro, apenas o corpo do texto. NUNCA coloque 'Imagem:', 'Search query:' ou descri\u00E7\u00F5es da imagem dentro deste campo.\",\r\n      \"image_search_query\": \"English visual search query for Pixabay. Follow the Advanced Anti-Noise template: [who], [specific action], [specific environment], [emotional tone], [lighting], [color direction], [composition], [quality markers], [minimum 6 exclusions with -]\"\r\n    }\r\n  `;\r\n\r\n    const userPrompt = `\r\nT\u00F3pico: \"${job.topic}\"\r\nCluster: \"${job.cluster}\"\r\nInten\u00E7\u00E3o: \"${job.intent}\"\r\n    \r\n    ${internalLinksPrompt}\r\n    \r\n    Escreva um artigo de > 1000 palavras.\r\n    Use Portugu\u00EAs do Brasil.\r\n\r\n    IMPORTANTE: Retorne APENAS o JSON v\u00E1lido.\r\n  `;\r\n\r\n    let aiResponse;\r\n    try {\r\n        aiResponse = await env.AI.run('@cf/meta/llama-3-8b-instruct', {\r\n            messages: [\r\n                { role: 'system', content: systemPrompt },\r\n                { role: 'user', content: userPrompt }\r\n            ],\r\n            max_tokens: 4000\r\n        });\r\n    } catch (e) {\r\n        return { success: false, error: `AI Failed: ${e.message}` };\r\n    }\r\n\r\n    let raw = aiResponse.response.trim();\r\n    const firstBrace = raw.indexOf('{');\r\n    const lastBrace = raw.lastIndexOf('}');\r\n\r\n    if (firstBrace >= 0 && lastBrace > firstBrace) {\r\n        raw = raw.substring(firstBrace, lastBrace + 1);\r\n    }\r\n\r\n    const postData = { cluster: job.cluster, intent: job.intent };\r\n    let parseSuccess = false;\r\n\r\n    try {\r\n        const parsed = JSON.parse(raw);\r\n        Object.assign(postData, parsed);\r\n        if (parsed.content) postData.content_markdown = parsed.content;\r\n        parseSuccess = true;\r\n    } catch (e) {\r\n        console.warn(\"[PARSER] JSON.parse falhou. Tentando extra\u00E7\u00E3o manual...\");\r\n    }\r\n\r\n    if (!parseSuccess) {\r\n        try {\r\n            const extract = (key) => {\r\n                const match = raw.match(new RegExp(`\"${key}\"\\\\s *: \\\\s * \"(.*?)\"`, 's'));\r\n                return match ? match[1] : null;\r\n            };\r\n\r\n            postData.title = extract(\"title\");\r\n            postData.slug = extract(\"slug\");\r\n            postData.description = extract(\"description\");\r\n\r\n            const contentMatch = raw.match(/\"content\"\\s*:\\s*\"(.*)\"\\s*}/s) || raw.match(/\"content\"\\s*:\\s*\"(.*)/s);\r\n            if (contentMatch) {\r\n                let content = contentMatch[1];\r\n                if (content.endsWith('\"}')) content = content.slice(0, -2);\r\n                else if (content.endsWith('\"')) content = content.slice(0, -1);\r\n                postData.content_markdown = content.replace(/\\\\n/g, '\\n').replace(/\\\\\"/g, '\"');\r\n            }\r\n\r\n            const tagsMatch = raw.match(/\"tags\"\\s*:\\s*\\[(.*?)\\]/s);\r\n            if (tagsMatch) {\r\n                postData.tags = tagsMatch[1].split(',').map(t => t.replace(/[\"\\s]/g, ''));\r\n            }\r\n        } catch (e2) {\r\n            console.error(\"Parser Regex falhou tamb\u00E9m.\");\r\n        }\r\n    }\r\n\r\n    // TENTATIVA 3 (Extra): Extrair image_search_query via Regex isolado se n\u00E3o veio\r\n    if (!postData.image_search_query) {\r\n        const imgMatch = raw.match(/\"image_search_query\"\\s*:\\s*\"(.*?)\"/s);\r\n        if (imgMatch) postData.image_search_query = imgMatch[1];\r\n    }\r\n\r\n    // FALLBACKS DE SEGURAN\u00C7A (Se tudo falhar, n\u00E3o perde o post)\r\n    if (!postData.title) postData.title = job.topic;\r\n    if (!postData.slug) postData.slug = job.topic.toLowerCase().replace(/ /g, '-');\r\n    if (!postData.content_markdown) {\r\n        console.warn(\"IA ignorou JSON. Usando RAW como conte\u00FAdo.\");\r\n        postData.content_markdown = raw;\r\n    }\r\n\r\n    postData.slug = postData.slug.toLowerCase().replace(/[^a-z0-9-]/g, '');\r\n    postData.title = postData.title.trim();\r\n\r\n    const validation = validatePost(postData);\r\n    if (!validation.valid) return { success: false, error: validation.reason };\r\n\r\n    if (await checkFileExists(env, `${postData.slug}.md`)) {\r\n        return { success: false, reason: \"DUPLICATE_SLUG\", error: \"Exists\" };\r\n    }\r\n\r\n    // ETAPA 6: MONTAGEM FINAL\r\n    // INJE\u00C7\u00C3O DE IMAGEM AUTOM\u00C1TICA (Curador V8.1 - Reativado)\r\n    if (!postData.image) {\r\n        // [MELHORIA] Tradu\u00E7\u00E3o de Query\r\n        // Se a query visual n\u00E3o veio, ou se parece com o t\u00EDtulo em PT, tentamos traduzir/gerar keywords em ingl\u00EAs.\r\n        let searchQuery = postData.image_search_query;\r\n\r\n        if (!searchQuery || searchQuery.trim() === job.topic.trim()) {\r\n            const translated = await generateVisualKeywords(env, job.topic);\r\n            if (translated) searchQuery = translated;\r\n        }\r\n\r\n        // Passamos a query final (da AI ou traduzida) + o cluster\r\n        postData.image = await getImageWithFallback(job.cluster, env, searchQuery || job.topic);\r\n    }\r\n\r\n    // LIMPEZA DE CONTE\u00DADO V8.3 - Remove metadados t\u00E9cnicos vazados\r\n    postData.content_markdown = sanitizeContent(postData.content_markdown);\r\n\r\n    const finalMarkdown = `---\r\ntitle: \"${postData.title.replace(/\"/g, '\\\\\"')}\"\r\ndate: \"${new Date().toISOString().split('T')[0]}\"\r\ndescription: \"${postData.description.replace(/\"/g, '\\\\\"')}\"\r\ntags: [${postData.tags.map(t => `\"${t}\"`).join(', ')}]\r\ncategory: \"${job.cluster}\"\r\nauthor: \"Lexis Intel AI\"\r\nimage: \"${postData.image}\"\r\ncluster: \"${job.cluster}\"\r\nintent: \"${job.intent}\"\r\n---\r\n\r\n${postData.content_markdown}\r\n\r\n---\r\n*Este artigo \u00E9 parte da nossa s\u00E9rie sobre **${job.cluster}**. Continue treinando:*\r\n${relatedPosts.map(p => `- [${p.title}](/blog/${p.slug})`).join('\\n')}\r\n`;\r\n\r\n    const result = await uploadToGitHub(env, `${postData.slug}.md`, finalMarkdown, `feat(blog): [${job.cluster}] ${postData.title} `);\r\n    return { success: true, url: result.url, slug: postData.slug, title: postData.title };\r\n}\r\n\r\n// --- KV HELPER (BRAIN) ---\r\nasync function addToClusterIndex(env, cluster, postMeta) {\r\n    const key = `index:${cluster}`;\r\n    let current = await env.LEXIS_PAUTA.get(key);\r\n    let posts = current ? JSON.parse(current) : [];\r\n\r\n    if (!postMeta.published_at) {\r\n        postMeta.published_at = new Date().toISOString().split('T')[0];\r\n    }\r\n\r\n    if (!posts.find(p => p.slug === postMeta.slug)) {\r\n        posts.push(postMeta);\r\n        await env.LEXIS_PAUTA.put(key, JSON.stringify(posts));\r\n    }\r\n}\r\n\r\nasync function getRelatedPosts(env, cluster) {\r\n    const key = `index:${cluster}`;\r\n    const data = await env.LEXIS_PAUTA.get(key);\r\n    if (!data) return [];\r\n\r\n    const posts = JSON.parse(data);\r\n    return posts.sort(() => 0.5 - Math.random()).slice(0, 3);\r\n}\r\n\r\n// --- UTILS ---\r\nfunction sanitizeContent(content) {\r\n    if (!content) return content;\r\n\r\n    let cleaned = content;\r\n\r\n    // 1. Remove linhas com \"image_search_query\" (formato JSON ou texto solto)\r\n    cleaned = cleaned.replace(/[,\\s]*\"image_search_query\"\\s*:\\s*\"[^\"]*\"/gi, '');\r\n    cleaned = cleaned.replace(/.*image_search_query.*\\n?/gi, '');\r\n\r\n    // 2. Remove restos de JSON artifacts (chaves soltas, v\u00EDrgulas extras)\r\n    cleaned = cleaned.replace(/^\\s*[,}\\]]\\s*$/gm, ''); // Linhas com apenas }, ], ou v\u00EDrgulas\r\n    cleaned = cleaned.replace(/,\\s*}/g, '}'); // V\u00EDrgulas antes de fechar objeto\r\n    cleaned = cleaned.replace(/,\\s*\\]/g, ']'); // V\u00EDrgulas antes de fechar array\r\n\r\n    // 3. Remove aspas escapadas desnecess\u00E1rias no meio do texto\r\n    cleaned = cleaned.replace(/\\\\\"/g, '\"');\r\n\r\n    // 4. Remove blocos de c\u00F3digo JSON vazios ou quebrados\r\n    cleaned = cleaned.replace(/```json\\s*\\n\\s*```/gi, '');\r\n    cleaned = cleaned.replace(/```\\s*\\n\\s*```/g, '');\r\n\r\n    // 5. Limpa m\u00FAltiplas linhas em branco consecutivas (deixa no m\u00E1ximo 2)\r\n    cleaned = cleaned.replace(/\\n{4,}/g, '\\n\\n\\n');\r\n\r\n    // 6. Remove espa\u00E7os em branco no final das linhas\r\n    cleaned = cleaned.replace(/[ \\t]+$/gm, '');\r\n\r\n    // 7. Remove artefatos de final de JSON (\", ou \" ou }, no final do arquivo)\r\n    cleaned = cleaned.replace(/\",\\s*$/, \"\");\r\n    cleaned = cleaned.replace(/\"\\s*$/, \"\");\r\n\r\n    // 8. [NOVO] Remove metadados descritivos de imagem vazados (Identificados pelo User)\r\n    // Ex: \"Imagem: Uma foto...\", \"Search query: ...\", \"| A imagem n\u00E3o condiz...\"\r\n    cleaned = cleaned.replace(/^Imagem:.*$/gim, '');\r\n    cleaned = cleaned.replace(/^Image:.*$/gim, '');\r\n    cleaned = cleaned.replace(/^Search query:.*$/gim, '');\r\n    cleaned = cleaned.replace(/^Query:.*$/gim, '');\r\n    cleaned = cleaned.replace(/\\| A imagem n\u00E3o condiz com o tema/gi, ''); // Remo\u00E7\u00E3o cir\u00FArgica do erro relatado\r\n\r\n    return cleaned.trim();\r\n}\r\nfunction validatePost(post) {\r\n    if (post.content_markdown.length < 400) return { valid: false, reason: \"Short Content\" };\r\n    if (!post.content_markdown.includes(\"##\")) return { valid: false, reason: \"No Structure (H2)\" };\r\n    return { valid: true };\r\n}\r\n\r\nasync function checkFileExists(env, fileName) {\r\n    const r = await fetch(`https://api.github.com/repos/${env.GITHUB_OWNER}/${env.GITHUB_REPO}/contents/src/posts/${fileName}`, {\r\n        headers: { \"Authorization\": `Bearer ${env.GITHUB_TOKEN}`, \"User-Agent\": \"Lexis-Worker\" }\r\n    });\r\n    return r.status === 200;\r\n}\r\n\r\nasync function uploadToGitHub(env, fileName, content, message) {\r\n    const r = await fetch(`https://api.github.com/repos/${env.GITHUB_OWNER}/${env.GITHUB_REPO}/contents/src/posts/${fileName}`, {\r\n        method: \"PUT\",\r\n        headers: { \"Authorization\": `Bearer ${env.GITHUB_TOKEN}`, \"User-Agent\": \"Lexis-Worker\" },\r\n        body: JSON.stringify({\r\n            message,\r\n            content: btoa(unescape(encodeURIComponent(content))),\r\n            branch: env.GITHUB_BRANCH\r\n        })\r\n    });\r\n    const d = await r.json();\r\n    if (!r.ok) throw new Error(d.message);\r\n    return { url: d.content.html_url };\r\n}\r\n\r\n// Mapa de queries para cada cluster (para buscar no Unsplash)\r\nconst CLUSTER_QUERIES = {\r\n    'business': 'business professional office work',\r\n    'viagem': 'travel adventure landscape nature',\r\n    'estudo': 'study learning education books',\r\n    'imersao': 'immersion study language travel brazil',\r\n    'cultural': 'brazil culture carnival festival parade',\r\n    'mindset': 'meditation focus mindfulness wellness',\r\n    'default': 'inspiration motivation success'\r\n};\r\n\r\n// ============================================\r\n// FUN\u00C7\u00C3O PRINCIPAL: Buscar imagem com fallback\r\n// ============================================\r\nasync function getImageWithFallback(cluster, env, specificQuery = null) {\r\n        // SISTEMA DE IMAGENS DESATIVADO - Blog apenas com texto\r\n    console.log(`[IMAGE] Sistema de imagens desativado. Posts ser\u00E3o gerados sem imagens.`);\r\n    return null;\r\n\r\n    /* C\u00D3DIGO ANTIGO COMENTADO\r\nconsole.log(`[IMAGE] Buscando imagem. Cluster: ${cluster} | Query Espec\u00EDfica: ${specificQuery || \"Nenhuma\"}`);\r\n\r\n    // Define a query final: Se tiver espec\u00EDfica (da IA), usa ela. Se n\u00E3o, usa a do cluster.\r\n    // Se a espec\u00EDfica for muito curta (<3 chars), ignora.\r\n    let finalQuery = (specificQuery && specificQuery.length > 3)\r\n        ? specificQuery\r\n        : (CLUSTER_QUERIES[cluster] || CLUSTER_QUERIES['default']);\r\n\r\n    // TENTATIVA 1: Pixabay API\r\n    if (env.PIXABAY_API_KEY && env.PEXELS_ENABLED === 'true') {\r\n        try {\r\n            console.log(`[PIXABAY] Buscando: \"${finalQuery}\"`);\r\n            const image = await getPixabayImage(finalQuery, env.PIXABAY_API_KEY);\r\n            if (image) {\r\n                console.log(`[PIXABAY] \u2705 Sucesso! URL: ${image.substring(0, 50)}...`);\r\n                return image;\r\n            }\r\n        } catch (error) {\r\n            console.warn(`[PIXABAY] \u274C Falha: ${error.message}. Usando fallback...`);\r\n        }\r\n    } else {\r\n        console.log(`[PIXABAY] Desabilitado ou sem chave. Usando banco curado.`);\r\n    }\r\n\r\n    // FALLBACK 1: Sistema dinamico de fallback (pool de imagens genericas)\r\n    console.log(`[FALLBACK-DYNAMIC] Buscando imagem do pool dinamico...`);\r\n    try {\r\n        const fallbackImage = await getFallbackImage(env);\r\n        if (fallbackImage) {\r\n            console.log(`[FALLBACK-DYNAMIC] Imagem de fallback encontrada`);\r\n            return fallbackImage;\r\n        }\r\n    } catch (error) {\r\n        console.warn(`[FALLBACK-DYNAMIC] Erro: ${error.message}. Usando banco curado...`);\r\n    }\r\n\r\n    // FALLBACK 2: Banco de imagens curado (estatico)\r\n    console.log(`[FALLBACK-STATIC] Usando banco de imagens estatico...`);\r\n    const curatedImage = getCuratedImage(cluster);\r\n    if (curatedImage) {\r\n        console.log(`[FALLBACK-STATIC] Imagem curada encontrada`);\r\n        return curatedImage;\r\n    }\r\n\r\n    // FALLBACK 3: Imagem padrao final\r\n    console.log(`[FALLBACK-HARDCODED] Usando imagem padrao final`);\r\n    return \"https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=1200&q=80\";\r\n        */\r\n}\r\n\r\n// ============================================\r\n// FUN\u00C7\u00C3O: Buscar do Pixabay API\r\n// ============================================\r\nasync function getPixabayImage(query, accessKey) {\r\n    try {\r\n        const url = `https://pixabay.com/api/?key=${accessKey}&q=${encodeURIComponent(query)}&image_type=photo&orientation=horizontal&per_page=20`;\r\n\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), 5000);\r\n\r\n        const response = await fetch(url, {\r\n            signal: controller.signal\r\n        });\r\n\r\n        clearTimeout(timeoutId);\r\n\r\n        if (!response.ok) return null;\r\n\r\n        const data = await response.json();\r\n\r\n        // CORRE\u00C7\u00C3O: Seleciona aleatoriamente uma das imagens retornadas para evitar duplicidade\r\n        if (data.hits && data.hits.length > 0) {\r\n            const randomIndex = Math.floor(Math.random() * data.hits.length);\r\n            const imageUrl = data.hits[randomIndex].largeImageURL;\r\n\r\n            console.log(`[PIXABAY] \u2705 Sucesso! URL: ${imageUrl.substring(0, 50)}... (Index: ${randomIndex}/${data.hits.length})`);\r\n            return imageUrl;\r\n        }\r\n\r\n        return null;\r\n    } catch (error) {\r\n        console.error(`[PIXABAY API] \u274C Erro: ${error.message}`);\r\n        return null;\r\n    }\r\n}\r\n\r\n// --- BANCO DE IMAGENS ---\r\nfunction getCuratedImage(cluster) {\r\n    const COLLECTIONS = {\r\n        'business': [\r\n            \"https://images.unsplash.com/photo-1517048676732-d65bc937f952?w=1200&q=80\",\r\n            \"https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=1200&q=80\"\r\n        ],\r\n        'viagem': [\r\n            \"https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=1200&q=80\",\r\n            \"https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1200&q=80\"\r\n        ],\r\n        'estudo': [\r\n            \"https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=1200&q=80\",\r\n            \"https://images.unsplash.com/photo-1513258496099-48168024aec0?w=1200&q=80\"\r\n        ],\r\n        'mindset': [\r\n            \"https://images.unsplash.com/photo-1499209974431-2761e2523676?w=1200&q=80\",\r\n            \"https://images.unsplash.com/photo-1456324504439-367cee3b3c32?w=1200&q=80\"\r\n        ],\r\n        'default': [\r\n            \"https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=1200&q=80\"\r\n        ]\r\n    };\r\n    const key = cluster ? cluster.toLowerCase() : 'default';\r\n    const collection = COLLECTIONS[key] || COLLECTIONS['default'];\r\n    return collection[Math.floor(Math.random() * collection.length)];\r\n}\r\n\r\n// ============================================\r\n// MODULO: PLANEJAMENTO ESTRAT\u00C9GICO (IA)\r\n// ============================================\r\n\r\n// 1. Analisar Hist\u00F3rico do GitHub\r\nasync function analyzePostHistory(env) {\r\n    console.log('[ANALISE] Iniciando an\u00E1lise de hist\u00F3rico...');\r\n\r\n    try {\r\n        const response = await fetch(\r\n            `https://api.github.com/repos/${env.GITHUB_OWNER}/${env.GITHUB_REPO}/contents/src/posts`,\r\n            {\r\n                headers: {\r\n                    'Authorization': `Bearer ${env.GITHUB_TOKEN}`,\r\n                    'User-Agent': 'Lexis-Worker'\r\n                }\r\n            }\r\n        );\r\n\r\n        if (!response.ok) throw new Error(`GitHub API Error: ${response.status}`);\r\n        const files = await response.json();\r\n\r\n        const categoryCounts = {};\r\n        let totalFiles = 0;\r\n\r\n        // Categorias base para garantir que existam no objeto\r\n        const baseCategories = ['estudo', 'imersao', 'viagem', 'vocabulario', 'profissional', 'mindset', 'pronuncia', 'gramatica', 'conversacao', 'neurociencia'];\r\n        baseCategories.forEach(c => categoryCounts[c] = 0);\r\n\r\n        // Amostragem: Analisar os 20 \u00FAltimos posts para ser r\u00E1pido (ou todos se der)\r\n        // O GitHub retorna em ordem alfab\u00E9tica. Vamos pegar os \u00FAltimos 20.\r\n        // Slice(-20) pega os \u00FAltimos 20 elementos do array.\r\n        const allFiles = files.filter(f => f.name.endsWith('.md'));\r\n        const targetFiles = allFiles.slice(-20);\r\n\r\n        console.log(`[ANALISE] Encontrados ${targetFiles.length} arquivos.`);\r\n\r\n        // Processamento paralelo limitado (batch de 5)\r\n        for (let i = 0; i < targetFiles.length; i += 5) {\r\n            const batch = targetFiles.slice(i, i + 5);\r\n            await Promise.all(batch.map(async (file) => {\r\n                try {\r\n                    const contentResponse = await fetch(file.download_url);\r\n                    const content = await contentResponse.text();\r\n\r\n                    // Extrair cluster/categoria\r\n                    const match = content.match(/cluster:\\s*[\"']?([^\"'\\n]+)[\"']?/i) || content.match(/category:\\s*[\"']?([^\"'\\n]+)[\"']?/i);\r\n                    if (match) {\r\n                        const cat = match[1].trim().toLowerCase();\r\n                        categoryCounts[cat] = (categoryCounts[cat] || 0) + 1;\r\n                        totalFiles++;\r\n                    }\r\n                } catch (e) {\r\n                    console.warn(`Erro ao ler ${file.name}: ${e.message}`);\r\n                }\r\n            }));\r\n        }\r\n\r\n        // Estat\u00EDsticas\r\n        const distribution = {};\r\n        for (const [cat, count] of Object.entries(categoryCounts)) {\r\n            distribution[cat] = {\r\n                count,\r\n                percentage: totalFiles > 0 ? ((count / totalFiles) * 100).toFixed(1) : \"0.0\"\r\n            };\r\n        }\r\n\r\n        // Gaps (< 10%)\r\n        const gaps = Object.entries(distribution)\r\n            .filter(([_, data]) => parseFloat(data.percentage) < 10)\r\n            .map(([cat]) => cat);\r\n\r\n        return { distribution, gaps, totalPosts: totalFiles };\r\n\r\n    } catch (e) {\r\n        console.error(`[ANALISE] Falha Fatal: ${e.message}`);\r\n        return { distribution: {}, gaps: ['geral'], error: e.message };\r\n    }\r\n}\r\n\r\n// 2. Contexto Temporal\r\nfunction getTemporalContext() {\r\n    const hoje = new Date();\r\n    const mes = hoje.getMonth() + 1;\r\n\r\n    // Eventos (Simplificado & Localizado)\r\n    const eventosVals = [\r\n        { m: 1, d: 1, n: 'Ano Novo' },\r\n        { m: 2, d: 14, n: 'Valentine\\'s Day (Data Americana/Internacional)' },\r\n        { m: 2, d: 20, n: 'Carnaval (Brasil)' },\r\n        { m: 3, d: 8, n: 'Dia da Mulher' },\r\n        { m: 3, d: 17, n: 'St. Patrick\\'s Day (Cultural)' },\r\n        { m: 4, d: 21, n: 'P\u00E1scoa' },\r\n        { m: 6, d: 12, n: 'Dia dos Namorados (Brasil)' },\r\n        { m: 7, d: 4, n: 'Independence Day (USA - Cultural)' },\r\n        { m: 10, d: 12, n: 'Dia das Crian\u00E7as / N. Sra. Aparecida' },\r\n        { m: 10, d: 31, n: 'Halloween (Cultural)' },\r\n        { m: 11, d: 2, n: 'Finados' },\r\n        { m: 11, d: 15, n: 'Proclama\u00E7\u00E3o da Rep\u00FAblica' },\r\n        { m: 11, d: 25, n: 'Thanksgiving (USA - Cultural)' },\r\n        { m: 12, d: 25, n: 'Natal' }\r\n    ];\r\n\r\n    const eventosProximos = eventosVals\r\n        .filter(e => e.m === mes || e.m === mes + 1)\r\n        .map(e => e.n);\r\n\r\n    let estacao = (mes >= 12 || mes <= 2) ? 'Ver\u00E3o (Brasil)' : (mes >= 6 && mes <= 8) ? 'Inverno (Brasil)' : (mes >= 3 && mes <= 5) ? 'Outono (Brasil)' : 'Primavera (Brasil)';\r\n\r\n    return {\r\n        data: hoje.toISOString().split('T')[0],\r\n        estacao,\r\n        eventosProximos\r\n    };\r\n}\r\n\r\n// 3. Sele\u00E7\u00E3o IA\r\nasync function selectThemesByAI(env) {\r\n    const analysis = await analyzePostHistory(env);\r\n    const context = getTemporalContext();\r\n\r\n    const prompt = `\r\n    ATUE COMO: Estrategista de Conte\u00FAdo S\u00EAnior da Lexis Academy (Escola de Ingl\u00EAs para Brasileiros).\r\n    \r\n    DADOS:\r\n    - Total Posts: ${analysis.totalPosts}\r\n    - GAPS (Prioridade): ${analysis.gaps.join(', ')}\r\n    - Contexto: ${context.data} (${context.estacao}). Eventos Pr\u00F3ximos: ${context.eventosProximos.join(', ')}\r\n    \r\n    TAREFA:\r\n    Gere 3 sugest\u00F5es de pauta IN\u00C9DITAS para preencher os gaps e aproveitar o contexto.\r\n    \r\n    REGRAS:\r\n    1. P\u00FAblico: Brasileiros aprendendo ingl\u00EAs.\r\n    2. Contexto Cultural: Se citar datas comemorativas estrangeiras (ex: Valentine's Day em Fev), aborde como \"Curiosidade Cultural\" ou \"Vocabul\u00E1rio Espec\u00EDfico\", deixando claro a diferen\u00E7a para o Brasil.\r\n    3. T\u00EDtulos: Magn\u00E9ticos e em Portugu\u00EAs.\r\n    4. Diversifique os clusters.\r\n    \r\n    SA\u00CDDA (JSON Puro):\r\n    {\r\n      \"temas\": [\r\n        {\r\n          \"topic\": \"T\u00EDtulo do Post\",\r\n          \"cluster\": \"categoria-do-gap\",\r\n          \"intent\": \"dor|decisao|cultural\",\r\n          \"justificativa\": \"Motivo da escolha\"\r\n        }\r\n      ]\r\n    }\r\n    `;\r\n\r\n    try {\r\n        const aiRes = await env.AI.run('@cf/meta/llama-3-8b-instruct', {\r\n            messages: [{ role: 'user', content: prompt }]\r\n        });\r\n\r\n        let text = aiRes.response;\r\n        let temas = [];\r\n\r\n        // TENTATIVA 1: JSON.parse DIRETO\r\n        try {\r\n            const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\r\n            if (jsonMatch) {\r\n                const data = JSON.parse(jsonMatch[0]);\r\n                temas = data.temas || data.themes || [];\r\n            }\r\n        } catch (e) {\r\n            console.warn(\"[IA-PLAN] JSON Parse falhou. Tentando Regex...\");\r\n        }\r\n\r\n        // TENTATIVA 2: REGEX FALLBACK (Se o JSON veio quebrado)\r\n        if (temas.length === 0) {\r\n            // Regex para capturar objetos { \"topic\": ... } individualmente\r\n            const objectRegex = /{\\s*\"topic\":\\s*\"(.*?)\",\\s*\"cluster\":\\s*\"(.*?)\",\\s*\"intent\":\\s*\"(.*?)\",\\s*\"justificativa\":\\s*\"(.*?)\"\\s*}/g;\r\n            let match;\r\n            while ((match = objectRegex.exec(text)) !== null) {\r\n                temas.push({\r\n                    topic: match[1],\r\n                    cluster: match[2],\r\n                    intent: match[3],\r\n                    justificativa: match[4]\r\n                });\r\n            }\r\n        }\r\n\r\n        // TENTATIVA 3 (\u00DAltimo recurso): Regex mais permissivo\r\n        if (temas.length === 0) {\r\n            const simpleRegex = /\"topic\":\\s*\"(.*?)\".*?\"cluster\":\\s*\"(.*?)\"/gs;\r\n            let match;\r\n            while ((match = simpleRegex.exec(text)) !== null) {\r\n                temas.push({\r\n                    topic: match[1],\r\n                    cluster: match[2],\r\n                    intent: 'informacional', // Default\r\n                    justificativa: 'Recuperado via Regex Simples'\r\n                });\r\n                if (temas.length >= 3) break;\r\n            }\r\n        }\r\n\r\n        if (temas.length === 0) {\r\n            return {\r\n                success: false,\r\n                error: \"IA n\u00E3o retornou temas v\u00E1lidos. Parse falhou.\",\r\n                raw: text\r\n            };\r\n        }\r\n\r\n        const added = [];\r\n        for (const tema of temas) {\r\n            const id = Date.now().toString() + Math.floor(Math.random() * 1000);\r\n            const job = {\r\n                topic: tema.topic,\r\n                cluster: tema.cluster.toLowerCase(),\r\n                intent: tema.intent || 'informacional',\r\n                status: 'pending',\r\n                created_at: new Date().toISOString(),\r\n                ai_generated: true,\r\n                justification: tema.justificativa || tema.justification\r\n            };\r\n\r\n            await env.LEXIS_PAUTA.put(`job:${id}`, JSON.stringify(job));\r\n            added.push(job);\r\n        }\r\n\r\n        return { success: true, analysis, new_jobs: added };\r\n\r\n    } catch (e) {\r\n        return { success: false, error: e.message };\r\n    }\r\n}\r\n\r\n// ============================================\r\n// HELPER: GERA\u00C7\u00C3O DE PROMPTS PROFISSIONAIS (ART DIRECTOR)\r\n// ============================================\r\nasync function generateVisualKeywords(env, topic) {\r\n    if (!topic) return null;\r\n    console.log(`[ART DIRECTOR] Gerando prompt avan\u00E7ado (TEMPLATE ANTIRRU\u00CDDO) para: \"${topic}\"`);\r\n\r\n    const FORBIDDEN_KEYWORDS = [\r\n        'neuroscience', 'brain', 'science', 'concept', 'abstract',\r\n        'success', 'motivation', 'inspiration', 'achievement',\r\n        'communication', 'connection', 'network', 'idea',\r\n        'innovation', 'creativity', 'strategy', 'solution'\r\n    ];\r\n\r\n    try {\r\n        const artDirectorPrompt = `\r\n        ACT AS: Strategic Art Director specialized in keyword-based image banks (Pixabay, Unsplash, Pexels).\r\n        USER MISSION: Create a highly assertive English prompt for a blog hero image.\r\n\r\n        BLOG TOPIC: \"${topic}\"\r\n\r\n        STEP 1: INTERNAL DIAGNOSIS (Do not include in output)\r\n        1. Classify the theme into ONE category: Relationship, Business, Technology, Culture, Education, Productivity, Health, Marketing, or Other.\r\n        2. Convert the abstract theme into a CONCRETE HUMAN SCENE with:\r\n           - Specific Action\r\n           - Real Environment\r\n           - Predominant Emotion\r\n        3. Identify ambiguous words in the theme that might cause \"noise\" in the image bank.\r\n\r\n        STEP 2: PROMPT CONSTRUCTION RULES\r\n        - 100% English\r\n        - Real life scenes, NO abstract concepts\r\n        - Defined characters and clear actions\r\n        - Specific environment and explicit emotion\r\n        - Defined lighting and suggested color palette\r\n        - Hero Image requirements: Include \"wide horizontal composition\" and \"negative space for headline\"\r\n        - Mandatory Quality Markers: \"realistic editorial photography\", \"high resolution\", \"natural expressions\"\r\n        - Category-based Exclusions (Include at least 6 with a minus sign):\r\n          * Relationship: -festival -decoration -ceramic -handmade -craft -cartoon -wedding stage -proposal ring closeup\r\n          * Business: -handshake closeup -cartoon office -3d render -clipart -illustration -graph isolated\r\n          * Technology: -futuristic neon -robot cartoon -3d abstract background -digital illustration -metaverse art\r\n          * Culture: -pottery -traditional craft -costume performance -folk dance stage -artisan workshop -decoration closeup\r\n          * Education: -children cartoon -clipart -school drawing -illustration -blackboard isolated\r\n          * Productivity: -abstract concept -3d clock -floating icons -illustration -minimal icon set\r\n\r\n        OUTPUT FORMAT (Strictly one line, no explanation):\r\n        [who], [specific action], [specific environment], [emotional tone], [lighting], [color direction], [composition], [quality markers], [minimum 6 exclusions]\r\n\r\n        EXAMPLE:\r\n        A group of diverse friends laughing, sharing a meal at a rustic outdoor wooden table, feeling joyful and connected, soft golden hour sunlight, warm earth tones, wide horizontal composition, negative space for headline, realistic editorial photography, high resolution, natural expressions, -festival -decoration -ceramic -handmade -craft -cartoon -wedding stage -proposal ring closeup\r\n        `;\r\n\r\n        const response = await env.AI.run('@cf/meta/llama-3-8b-instruct', {\r\n            messages: [\r\n                { role: 'system', content: artDirectorPrompt },\r\n                { role: 'user', content: `Generate the assertive English prompt for: ${topic}` }\r\n            ],\r\n            max_tokens: 250\r\n        });\r\n\r\n        let prompt = response.response.trim();\r\n\r\n        // Limpeza de artifacts\r\n        prompt = prompt.replace(/^[\"']|[\"']$/g, ''); // Remove aspas\r\n        prompt = prompt.replace(/^(Here is|Here's|Prompt:|The prompt is:?|Result:?)/gi, '').trim();\r\n        prompt = prompt.replace(/\\n.*/g, ''); // Remove linhas extras\r\n\r\n        // Valida\u00E7\u00E3o b\u00E1sica: Se o prompt for muito curto ou n\u00E3o tiver exclus\u00F5es, tenta for\u00E7ar\r\n        if (prompt.length < 50 || !prompt.includes('-')) {\r\n            console.warn(\"[ART DIRECTOR] Prompt gerado parece incompleto. Usando estrutura de seguran\u00E7a.\");\r\n            const fallbackSuffix = \"wide horizontal composition, negative space for headline, realistic editorial photography, high resolution, natural expressions, -cartoon -clipart -3d -illustration -abstract -background\";\r\n            prompt = `${topic} scene with people, ${fallbackSuffix}`;\r\n        }\r\n\r\n        console.log(`[ART DIRECTOR] Prompt final: \"${prompt.substring(0, 100)}...\"`);\r\n        return prompt;\r\n\r\n    } catch (e) {\r\n        console.warn(`[ART DIRECTOR] Falha: ${e.message}`);\r\n        return \"authentic diverse people engaged in real activity, natural lighting, specific environment, wide horizontal composition, negative space for headline, realistic editorial photography, high resolution, -cartoon -clipart -3d -illustration\";\r\n    }\r\n}\r\n\r\n// 4. SITEMAP DIN\u00C2MICO (SEO V5.7)\r\nasync function generateDynamicSitemap(env) {\r\n    const baseUrl = \"https://lexis.academy\";\r\n    const today = new Date().toISOString().split('T')[0];\r\n\r\n    const staticPages = [\r\n        { loc: \"/\", priority: \"1.0\", changefreq: \"weekly\", lastmod: today },\r\n        { loc: \"/imersao\", priority: \"0.9\", changefreq: \"monthly\", lastmod: today },\r\n        { loc: \"/maestria\", priority: \"0.9\", changefreq: \"monthly\", lastmod: today },\r\n        { loc: \"/the-way\", priority: \"0.9\", changefreq: \"monthly\", lastmod: today },\r\n        { loc: \"/blog\", priority: \"0.8\", changefreq: \"daily\", lastmod: today },\r\n    ];\r\n\r\n    const clusters = [\"ingles\", \"metodologia\", \"imersao\", \"dicas\", \"estudo\", \"business\", \"viagem\", \"mindset\"];\r\n    const blogPosts = [];\r\n\r\n    for (const cluster of clusters) {\r\n        const indexKey = `index:${cluster}`;\r\n        const indexData = await env.LEXIS_PAUTA.get(indexKey);\r\n        if (indexData) {\r\n            try {\r\n                const posts = JSON.parse(indexData);\r\n                for (const post of posts) {\r\n                    blogPosts.push({\r\n                        loc: `/blog/${post.slug}`,\r\n                        priority: \"0.7\",\r\n                        changefreq: \"monthly\",\r\n                        lastmod: post.published_at || today\r\n                    });\r\n                }\r\n            } catch (e) {\r\n                console.error(`Erro ao parsear index:${cluster}`, e);\r\n            }\r\n        }\r\n    }\r\n\r\n    const urls = [...staticPages, ...blogPosts];\r\n    const xml = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\r\n${urls.map(page => `  <url>\r\n    <loc>${baseUrl}${page.loc}</loc>\r\n    <lastmod>${page.lastmod}</lastmod>\r\n    <changefreq>${page.changefreq}</changefreq>\r\n    <priority>${page.priority}</priority>\r\n  </url>`).join('\\n')}\r\n</urlset>`;\r\n\r\n    return new Response(xml, {\r\n        headers: {\r\n            \"Content-Type\": \"application/xml\",\r\n            \"Cache-Control\": \"public, max-age=3600\"\r\n        }\r\n    });\r\n}\r\n\r\n// --- RSS FEED DIN\u00C2MICO (SEO V5.7) ---\r\nasync function generateDynamicRSS(env) {\r\n    const baseUrl = \"https://lexis.academy\";\r\n    const today = new Date().toUTCString();\r\n\r\n    const clusters = [\"ingles\", \"metodologia\", \"imersao\", \"dicas\", \"estudo\", \"business\", \"viagem\", \"mindset\"];\r\n    const allPosts = [];\r\n\r\n    for (const cluster of clusters) {\r\n        const indexKey = `index:${cluster}`;\r\n        const indexData = await env.LEXIS_PAUTA.get(indexKey);\r\n        if (indexData) {\r\n            try {\r\n                const posts = JSON.parse(indexData);\r\n                for (const post of posts) {\r\n                    allPosts.push({\r\n                        title: post.title,\r\n                        link: `${baseUrl}/blog/${post.slug}`,\r\n                        pubDate: post.published_at ? new Date(post.published_at).toUTCString() : today,\r\n                        category: cluster\r\n                    });\r\n                }\r\n            } catch (e) {\r\n                console.error(`Erro ao parsear index:${cluster}`, e);\r\n            }\r\n        }\r\n    }\r\n\r\n    allPosts.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));\r\n\r\n    const rss = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<rss version=\"2.0\" xmlns:atom=\"http://www.w3.org/2005/Atom\">\r\n  <channel>\r\n    <title>Lexis Academy Blog</title>\r\n    <link>${baseUrl}/blog</link>\r\n    <description>Artigos sobre aprendizado de ingl\u00EAs, imers\u00E3o e flu\u00EAncia real - Metodologia Lexis</description>\r\n    <language>pt-BR</language>\r\n    <lastBuildDate>${today}</lastBuildDate>\r\n    <atom:link href=\"${baseUrl}/rss.xml\" rel=\"self\" type=\"application/rss+xml\"/>\r\n${allPosts.slice(0, 20).map(post => `    <item>\r\n      <title><![CDATA[${post.title}]]></title>\r\n      <link>${post.link}</link>\r\n      <guid>${post.link}</guid>\r\n      <pubDate>${post.pubDate}</pubDate>\r\n      <category>${post.category}</category>\r\n    </item>`).join('\\n')}\r\n  </channel>\r\n</rss>`;\r\n\r\n    return new Response(rss, {\r\n        headers: {\r\n            \"Content-Type\": \"application/rss+xml\",\r\n            \"Cache-Control\": \"public, max-age=3600\"\r\n        }\r\n    });\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
